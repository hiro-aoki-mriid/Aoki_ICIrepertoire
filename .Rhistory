setwd("C:/Users/puchi/Desktop/upload")
file.name <- "Ex124TCRBD_TRAC_mixcr/Ex124TCRBD_TRAC1_114_806811.clonotypes.TRA.txt"
data <- tableread_fast(file.name, header = TRUE, sep = '\t')
library(data.table)
tableread_fast = function(i, header=TRUE, quote="", sep=","){
tmp = fread(i, header=header, sep=sep, quote=quote, nThread=32)
tmp = as.data.frame(tmp)
return(tmp)
}
data <- tableread_fast(file.name, header = TRUE, sep = '\t')
setwd("C:/Users/puchi/Desktop/upload")
file.name <- "Ex124TCRBD_TRAC_mixcr/Ex124TCRBD_TRAC1_114_806811.clonotypes.TRA.txt"
data <- tableread_fast(file.name, header = TRUE, sep = '\t')
file.name <- "Ex124TCRBD_TRAC1_mixcr/Ex124TCRBD_TRAC1_114_806811.clonotypes.TRA.txt"
data <- tableread_fast(file.name, header = TRUE, sep = '\t')
head(Data)
head(data)
data$targetSequences
data$targetSequences <- gsub(",", "", data$targetSequences)
data$allVAlignments <- gsub(",", "", data$allVAlignments)
data$allDAlignments <- gsub(",", "", data$allDAlignments)
data$allJAlignments <- gsub(",", "", data$allJAlignments)
data$allCAlignments <- gsub(",", "", data$allCAlignments)
data <- data[, colnames(data) != "nSeqImputedVDJTranscriptWithout5UTR"]
data[is.na(data)] <- ""
count<-data$cloneCount
freq<-data$cloneFraction
ccr3nt<-data$nSeqImputedCDR3
ccr3aa<-data$aaSeqImputedCDR3
v<-str_sub(data$bestVHit, end=-4)
d<-str_sub(data$bestDHit, end=-4)
library(stringr)
v<-str_sub(data$bestVHit, end=-4)
d<-str_sub(data$bestDHit, end=-4)
j<-str_sub(data$bestJHit, end=-4)
VEnd<-data$allVAlignments
VEnd_0<-data$allVAlignments
VEnd_1 <- str_split(VEnd_0, pattern = "[|]", simplify = TRUE)
VEnd_1
if(length(VEnd_1)==0){ #これは何も入ってない場合．無視したい
} else if (is.na(VEnd_1)[1] == F) {
VEnd <- as.numeric(VEnd_1[,5])-1
} else{
VEnd<-data$allVAlignments
}
DStart<-data$allDAlignments
DStart_0<-data$allDAlignments
DStart_1 <- str_split(DStart_0, pattern = "[|]", simplify = TRUE)
if(length(DStart_1)==0){ #これは何も入ってない場合．無視したい
} else if (is.na(DStart_1)[1] == F) {
DStart <- as.numeric(DStart_1[,4])
} else{
DStart<-data$allDAlignments
}
VEnd<-data$allVAlignments
VEnd_0<-data$allVAlignments
VEnd_1 <- str_split(VEnd_0, pattern = "[|]", simplify = TRUE)
VEnd_1 <- str_split(data$allVAlignments, pattern = "[|]", simplify = TRUE)
VEnd_1
names(data)
ref.point <- str_split(data$refPoints, pattern = ":", simplify = TRUE)
ref.point
data <- tableread_fast(file.name, header = TRUE, sep = '\t')
data$targetSequences <- gsub(",", "", data$targetSequences)
data$allVAlignments <- gsub(",", "", data$allVAlignments)
data$allDAlignments <- gsub(",", "", data$allDAlignments)
data$allJAlignments <- gsub(",", "", data$allJAlignments)
data$allCAlignments <- gsub(",", "", data$allCAlignments)
data$refPoints <- gsub(",", "", data$refPoints)
data <- data[, colnames(data) != "nSeqImputedVDJTranscriptWithout5UTR"]
data[is.na(data)] <- ""
count<-data$cloneCount
freq<-data$cloneFraction
ccr3nt<-data$nSeqImputedCDR3
ccr3aa<-data$aaSeqImputedCDR3
v<-str_sub(data$bestVHit, end=-4)
d<-str_sub(data$bestDHit, end=-4)
j<-str_sub(data$bestJHit, end=-4)
ref.point <- str_split(data$refPoints, pattern = ":", simplify = TRUE)
ref.point
data$refPoints
file.name
#Extract largest clone in cell barcode and append cell barcode information
name_out <- str_split(file.name, "_")
CB <- name_out[[1]][[4]]
CB
file.name <- "Ex124TCRBD_TRAC1_114_806811.clonotypes.TRA.txt"
#Extract largest clone in cell barcode and append cell barcode information
name_out <- str_split(file.name, "_")
name_out
CB <- name_out[[1]][[4]]
CB_out <- str_split(CB, "\\.")
CB <- CB_out[[1]][[1]]
CB
d_out
file.name <- "Ex124TCRBD_TRAC1_mixcr/Ex124TCRBD_TRAC1_114_806811.clonotypes.TRA.txt"
data <- tableread_fast(file.name, header = TRUE, sep = '\t')
#Extract TCR information from mixcr output
count<-data$cloneCount
freq<-data$cloneFraction
ccr3nt<-data$nSeqImputedCDR3
ccr3aa<-data$aaSeqImputedCDR3
v<-str_sub(data$bestVHit, end=-4)
d<-str_sub(data$bestDHit, end=-4)
j<-str_sub(data$bestJHit, end=-4)
data3 <- rbind(count,freq,ccr3nt,ccr3aa,v,d,j,VEnd,DStart,DEnd,JStart)
data3 <- as.data.frame(t(data3))
names(data3) <- c("count","freq","ccr3nt","ccr3aa","v","d","j")
#Extract largest clone in cell barcode and append cell barcode information
name_out <- str_split(file.name, "_")
CB <- name_out[[1]][[4]]
CB_out <- str_split(CB, "\\.")
CB <- CB_out[[1]][[1]]
d_out <- d[1,]
d_out$CB <- CB
